args:
- default: true
  description: Indicator to search for
  name: indicator
  required: true
comment: 'Lookup incidents with specified indicator. Use currentIncidentId to omit
  the existing incident from output

  This automation runs using the default Limited User role, unless you explicitly
  change the permissions.

  For more information, see the section about permissions here: https://docs.paloaltonetworks.com/cortex/cortex-xsoar/6-2/cortex-xsoar-admin/playbooks/automations.html'
commonfields:
  id: findIncidentsWithIndicator
  version: -1
enabled: true
fromversion: 5.0.0
name: findIncidentsWithIndicator
outputs:
- contextPath: IncidentsWithIndicator.Indicator
  description: Indicator that was found in other incidents
- contextPath: IncidentsWithIndicator.incidentIDs
  description: Incident IDs that the indicator was found in
script: "var res = executeCommand(\"getIncidents\", {\"query\": 'indicator.value:\"\
  '+args.indicator+'\"'});\nvar incidentsIDs=[];\nvar foundIncidents = [];\nvar currIncidentID\
  \ = incidents[0].id;\nvar ec = {};\n\nvar dict={\n    'severity':{0:'Informational',1:'Low',2:'Medium',3:'High',4:'Critical'},\n\
  \    'status':{0:'Not-assigned',1:'Assigned',2:'Closed'}};\n\nif (res && res[0].Contents\
  \ && res[0].Contents.data) {\n    res[0].Contents.data.forEach(function (incident)\
  \ {\n        if (!incident.isPlayground && incident.id != currIncidentID) {\n  \
  \          foundIncidents.push(incident);\n        }\n    });\n}\n\nvar md=\"####\
  \ Searching for incidents with indicator: *\" + args.indicator + \"*\\n\";\n\n\n\
  if (foundIncidents.length > 0) {\n    ec = {\"IncidentsWithIndicator\":{\"Indicator\"\
  : args.indicator,\"incidentIDs\":[]}};\n\n    md += \"Found \" + foundIncidents.length\
  \ + \" incidents:\\n\";\n    md += \"ID|Name|Severity|Owner|Status\\n-|-|-|-|-\\\
  n\"\n\n    foundIncidents.forEach(function (incident) {\n        md += \"[#\"+incident.id+\"\
  ](/#/WarRoom/\"+incident.id+\")|\" + incident.name + \"|\" + dict.severity[incident.severity]\
  \ + \"|\" +incident.owner+\"|\"+\n                dict.status[incident.status] \
  \  +\"\\n\";\n        ec.IncidentsWithIndicator.incidentIDs.push(incident.id);\n\
  \    });\n} else {\n    md += \"No incidents found\"\n}\nreturn {Type: entryTypes.note,\
  \ Contents: foundIncidents, ContentsFormat: formats.json, HumanReadable: md, EntryContext:\
  \ ec};"
scripttarget: 0
tags:
- Utility
tests:
- No test
type: javascript
